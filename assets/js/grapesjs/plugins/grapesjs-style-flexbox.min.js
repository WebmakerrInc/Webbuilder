(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        define(['grapesjs'], factory);
    } else if (typeof exports === 'object') {
        module.exports = factory;
    } else {
        (root.grapesjs = root.grapesjs || {}).plugins.add('grapesjs-style-flexbox', factory);
    }
})(typeof globalThis !== 'undefined' ? globalThis : this, function (editor) {
    if (!editor || !editor.StyleManager) {
        return;
    }

    var sm = editor.StyleManager;

    var sectors = {
        container: {
            id: 'flex',
            name: 'Flex Container',
            open: false,
        },
        item: {
            id: 'flex-item',
            name: 'Flex Item',
            open: false,
        },
    };

    var ensureSector = function (config) {
        var sector = sm.getSector(config.id);

        if (!sector) {
            sector = sm.addSector(config.id, {
                name: config.name,
                open: config.open,
            });
        } else {
            if (config.name && sector.get('name') !== config.name) {
                sector.set('name', config.name);
            }
        }

        return sector;
    };

    var ensureProperty = function (sectorId, propertyConfig) {
        if (!propertyConfig || !propertyConfig.property) {
            return;
        }

        var existing = sm.getProperty(sectorId, propertyConfig.property);

        if (!existing) {
            sm.addProperty(sectorId, propertyConfig);
        }
    };

    ensureSector(sectors.container);
    ensureSector(sectors.item);

    var containerProps = [
        {
            property: 'display',
            type: 'select',
            defaults: 'flex',
            full: true,
            options: [
                { value: 'block', name: 'Block' },
                { value: 'inline-block', name: 'Inline Block' },
                { value: 'flex', name: 'Flex' },
                { value: 'inline-flex', name: 'Inline Flex' },
            ],
        },
        {
            property: 'flex-direction',
            type: 'radio',
            defaults: 'row',
            full: true,
            options: [
                { value: 'row', name: 'Row' },
                { value: 'row-reverse', name: 'Row Reverse' },
                { value: 'column', name: 'Column' },
                { value: 'column-reverse', name: 'Column Reverse' },
            ],
        },
        {
            property: 'flex-wrap',
            type: 'radio',
            defaults: 'nowrap',
            full: true,
            options: [
                { value: 'nowrap', name: 'No Wrap' },
                { value: 'wrap', name: 'Wrap' },
                { value: 'wrap-reverse', name: 'Wrap Reverse' },
            ],
        },
        {
            property: 'justify-content',
            type: 'select',
            defaults: 'flex-start',
            full: true,
            options: [
                { value: 'flex-start', name: 'Start' },
                { value: 'center', name: 'Center' },
                { value: 'flex-end', name: 'End' },
                { value: 'space-between', name: 'Space Between' },
                { value: 'space-around', name: 'Space Around' },
                { value: 'space-evenly', name: 'Space Evenly' },
            ],
        },
        {
            property: 'align-items',
            type: 'select',
            defaults: 'stretch',
            full: true,
            options: [
                { value: 'stretch', name: 'Stretch' },
                { value: 'flex-start', name: 'Start' },
                { value: 'center', name: 'Center' },
                { value: 'flex-end', name: 'End' },
                { value: 'baseline', name: 'Baseline' },
            ],
        },
        {
            property: 'align-content',
            type: 'select',
            defaults: 'stretch',
            full: true,
            options: [
                { value: 'stretch', name: 'Stretch' },
                { value: 'flex-start', name: 'Start' },
                { value: 'center', name: 'Center' },
                { value: 'flex-end', name: 'End' },
                { value: 'space-between', name: 'Space Between' },
                { value: 'space-around', name: 'Space Around' },
            ],
        },
        {
            property: 'gap',
            type: 'integer',
            units: ['px', 'em', 'rem', '%'],
            defaults: '0px',
            full: true,
        },
        {
            property: 'row-gap',
            type: 'integer',
            units: ['px', 'em', 'rem', '%'],
            defaults: '0px',
            full: true,
        },
        {
            property: 'column-gap',
            type: 'integer',
            units: ['px', 'em', 'rem', '%'],
            defaults: '0px',
            full: true,
        },
    ];

    containerProps.forEach(function (prop) {
        ensureProperty(sectors.container.id, prop);
    });

    var itemProps = [
        {
            property: 'order',
            type: 'integer',
            defaults: 0,
            min: -10,
            max: 10,
            step: 1,
        },
        {
            property: 'flex-grow',
            type: 'integer',
            defaults: 0,
            min: 0,
            max: 10,
            step: 1,
        },
        {
            property: 'flex-shrink',
            type: 'integer',
            defaults: 1,
            min: 0,
            max: 10,
            step: 1,
        },
        {
            property: 'flex-basis',
            type: 'text',
            defaults: 'auto',
            placeholder: 'auto | 50% | 200px',
            full: true,
        },
        {
            property: 'align-self',
            type: 'select',
            defaults: 'auto',
            full: true,
            options: [
                { value: 'auto', name: 'Auto' },
                { value: 'flex-start', name: 'Start' },
                { value: 'center', name: 'Center' },
                { value: 'flex-end', name: 'End' },
                { value: 'stretch', name: 'Stretch' },
                { value: 'baseline', name: 'Baseline' },
            ],
        },
    ];

    itemProps.forEach(function (prop) {
        ensureProperty(sectors.item.id, prop);
    });
});
